<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FastSwap.pro — Обмен 50+ валют</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', system-ui, sans-serif; }
        body { background: #f8f9fa; color: #212529; padding: 16px; }
        .container { max-width: 700px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 24px; }
        header h1 { font-size: 24px; color: #0d6efd; margin-bottom: 8px; }
        header p { color: #6c757d; font-size: 15px; }

        .card { background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); margin-bottom: 20px; }
        .input-group { margin-bottom: 18px; position: relative; }
        .input-group label { display: block; margin-bottom: 8px; font-weight: 600; color: #495057; font-size: 15px; }

        /* Общий стиль для всех полей */
        .input-field, .select-header {
            width: 100%; padding: 14px; border: 1px solid #ced4da; border-radius: 12px;
            font-size: 16px; background: white;
        }
        .input-field:focus, .select-header:focus {
            outline: none;
            border-color: #0d6efd;
            box-shadow: 0 0 0 2px rgba(13, 110, 253, 0.2);
        }

        /* Кастомный dropdown */
        .custom-select {
            position: relative;
            width: 100%;
        }
        .select-header {
            cursor: pointer; display: flex; justify-content: space-between; align-items: center;
        }
        .select-header::after {
            content: "▼"; font-size: 12px; color: #6c757d; transform: scaleY(0.6);
        }
        .select-options {
            position: absolute; top: 100%; left: 0; right: 0;
            background: white; border: 1px solid #ced4da; border-top: none;
            border-radius: 0 0 12px 12px; max-height: 250px; overflow-y: auto;
            z-index: 10; display: none; box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .select-options.active { display: block; }
        .search-input {
            width: 100%; padding: 10px 14px; border: none; border-bottom: 1px solid #eee;
            font-size: 15px; outline: none;
        }
        .option { padding: 12px 14px; cursor: pointer; font-size: 15px; }
        .option:hover { background: #f1f5ff; }
        .option.selected { background: #e7f1ff; font-weight: 600; }

        /* Подсказка под полем суммы */
        .hint {
            font-size: 13px; color: #6c757d; margin-top: 6px;
            position: absolute; left: 0; bottom: -22px;
        }

        .rate-info {
            background: #e7f1ff; border-radius: 12px; padding: 14px; text-align: center;
            margin: 20px 0; font-weight: 600; color: #0d6efd;
        }
        .result {
            text-align: center; margin: 20px 0; font-size: 18px; color: #212529;
        }
        button { 
            width: 100%; padding: 16px; background: #0d6efd; color: white; 
            border: none; border-radius: 12px; font-size: 17px; font-weight: 600; cursor: pointer;
        }
        button:hover { background: #0b5ed7; }
        button:disabled { background: #adb5bd; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>FastSwap.pro</h1>
            <p>Обмен 50+ валют: крипта, фиат, банки РФ</p>
        </header>

        <div class="card">
            <div class="input-group">
                <label>Отдаете</label>
                <div class="custom-select" id="fromSelect">
                    <div class="select-header" id="fromHeader">Выберите валюту</div>
                    <div class="select-options" id="fromOptions">
                        <input type="text" class="search-input" placeholder="Поиск...">
                        <div class="options-list" id="fromOptionsList"></div>
                    </div>
                </div>
            </div>

            <!-- Выбор банка (только если RUB) -->
            <div class="input-group" id="bankSelect" style="display: none;">
                <label>Банк / платёжная система</label>
                <div class="custom-select" id="bankSelectCustom">
                    <div class="select-header" id="bankHeader">Выберите банк</div>
                    <div class="select-options" id="bankOptions">
                        <input type="text" class="search-input" placeholder="Поиск...">
                        <div class="options-list" id="bankOptionsList"></div>
                    </div>
                </div>
            </div>

            <div class="input-group">
                <label>Сумма</label>
                <input type="number" id="amount" class="input-field" placeholder="Введите сумму" min="100" value="10000">
                <div class="hint" id="minHint">Минимальная сумма: 100 RUB</div>
            </div>

            <div class="arrow" style="text-align: center; margin: 16px 0; font-size: 24px; color: #0d6efd;">↓</div>

            <div class="input-group">
                <label>Получаете</label>
                <div class="custom-select" id="toSelect">
                    <div class="select-header" id="toHeader">Выберите валюту</div>
                    <div class="select-options" id="toOptions">
                        <input type="text" class="search-input" placeholder="Поиск...">
                        <div class="options-list" id="toOptionsList"></div>
                    </div>
                </div>
            </div>

            <div class="rate-info" id="rateInfo">Курс обновляется автоматически</div>
            <div class="result" id="result">—</div>
            <button id="nextBtn" disabled>Продолжить обмен</button>
        </div>
    </div>

    <script>
        // Валюты
        const currencies = [
            { value: "RUB", name: "Российский рубль (RUB)" },
            { value: "BTC", name: "Bitcoin (BTC)" },
            { value: "USDT", name: "Tether (USDT)" },
            { value: "ETH", name: "Ethereum (ETH)" },
            { value: "BNB", name: "Binance Coin (BNB)" },
            { value: "SOL", name: "Solana (SOL)" },
            { value: "XRP", name: "Ripple (XRP)" },
            { value: "ADA", name: "Cardano (ADA)" },
            { value: "DOGE", name: "Dogecoin (DOGE)" },
            { value: "TRX", name: "TRON (TRX)" },
            { value: "LTC", name: "Litecoin (LTC)" },
            { value: "MATIC", name: "Polygon (MATIC)" },
            { value: "DOT", name: "Polkadot (DOT)" },
            { value: "AVAX", name: "Avalanche (AVAX)" },
            { value: "SHIB", name: "Shiba Inu (SHIB)" },
            { value: "XMR", name: "Monero (XMR)" }
        ];

        // Банки
        const banks = [
            { value: "sber", name: "СберБанк" },
            { value: "tinkoff", name: "Тинькофф" },
            { value: "alfa", name: "Альфа-Банк" },
            { value: "vtb", name: "ВТБ" },
            { value: "gazprom", name: "Газпромбанк" },
            { value: "open", name: "Банк Открытие" },
            { value: "raiffeisen", name: "Райффайзен Банк" },
            { value: "pochta", name: "Почта Банк" },
            { value: "yoomoney", name: "ЮMoney (Яндекс)" },
            { value: "qiwi", name: "QIWI Кошелёк" },
            { value: "tochka", name: "Точка (для бизнеса)" },
            { value: "mts", name: "МТС Банк" }
        ];

        const cryptoCurrencies = currencies.filter(c => c.value !== "RUB");
        const allCurrencies = currencies;

        // Минимальные суммы (в единицах валюты)
        const minAmounts = {
            RUB: 100,
            BTC: 0.001,
            ETH: 0.01,
            USDT: 20,
            BNB: 0.05,
            SOL: 0.1,
            XRP: 20,
            ADA: 30,
            DOGE: 100,
            TRX: 100,
            LTC: 0.1,
            MATIC: 20,
            DOT: 5,
            AVAX: 1,
            SHIB: 100000,
            XMR: 0.05
        };

        const rates = {
            'RUB_BTC': 0.00000165, 'RUB_ETH': 0.000025, 'RUB_USDT': 0.011,
            'RUB_BNB': 0.000035, 'RUB_SOL': 0.00018, 'RUB_XRP': 0.017,
            'RUB_ADA': 0.038, 'RUB_DOGE': 0.15, 'RUB_LTC': 0.0016,
            'RUB_TRX': 0.12, 'RUB_MATIC': 0.019, 'RUB_DOT': 0.022,
            'RUB_AVAX': 0.011, 'RUB_SHIB': 1600, 'RUB_XMR': 0.0065,

            'BTC_RUB': 600000, 'ETH_RUB': 40000, 'USDT_RUB': 90,
            'BNB_RUB': 28000, 'SOL_RUB': 5500, 'XRP_RUB': 58,
            'ADA_RUB': 26, 'DOGE_RUB': 6.6, 'LTC_RUB': 620,
            'TRX_RUB': 8.3, 'MATIC_RUB': 52, 'DOT_RUB': 45,
            'AVAX_RUB': 90, 'SHIB_RUB': 0.000056, 'XMR_RUB': 154,

            'BTC_USDT': 65000, 'ETH_USDT': 3500, 'BNB_USDT': 600,
            'SOL_USDT': 150, 'XRP_USDT': 0.55, 'ADA_USDT': 0.45,
            'DOGE_USDT': 0.12, 'LTC_USDT': 80, 'TRX_USDT': 0.12,
            'MATIC_USDT': 0.85, 'DOT_USDT': 7.5, 'AVAX_USDT': 35,
            'SHIB_USDT': 0.00000002, 'XMR_USDT': 170,

            'USDT_BTC': 0.000015, 'USDT_ETH': 0.000285, 'USDT_BNB': 0.00166,
            'USDT_SOL': 0.0066, 'USDT_XRP': 1.8, 'USDT_ADA': 2.2,
            'USDT_DOGE': 8.3, 'USDT_LTC': 0.0125, 'USDT_TRX': 8.3,
            'USDT_MATIC': 1.17, 'USDT_DOT': 0.133, 'USDT_AVAX': 0.0285,
            'USDT_SHIB': 50000000, 'USDT_XMR': 0.00588
        };

        let fromValue = "RUB";
        let toValue = "BTC";
        let bankValue = "sber";

        // Универсальная функция для dropdown
        function initDropdown(id, list, initial, onChange) {
            const header = document.getElementById(`${id}Header`);
            const optionsList = document.getElementById(`${id}OptionsList`);
            const container = document.getElementById(`${id}SelectCustom` || `${id}Select`);
            const searchInput = document.querySelector(`#${id}Options .search-input`);

            function renderOptions(items) {
                optionsList.innerHTML = items.map(item => 
                    `<div class="option ${item.value === initial ? 'selected' : ''}" data-value="${item.value}">
                        ${item.name}
                    </div>`
                ).join('');
            }

            renderOptions(list);
            header.textContent = list.find(c => c.value === initial)?.name || "Выберите";
            onChange(initial);

            const selectEl = document.getElementById(`${id}SelectCustom`) || document.getElementById(`${id}Select`);
            selectEl.addEventListener('click', (e) => {
                e.stopPropagation();
                document.querySelectorAll('.select-options').forEach(el => {
                    if (el.id !== `${id}Options`) el.classList.remove('active');
                });
                document.getElementById(`${id}Options`).classList.toggle('active');
            });

            optionsList.addEventListener('click', (e) => {
                if (e.target.classList.contains('option')) {
                    const value = e.target.dataset.value;
                    const name = e.target.textContent;
                    header.textContent = name;
                    document.querySelectorAll(`#${id}Options .option`).forEach(el => el.classList.remove('selected'));
                    e.target.classList.add('selected');
                    document.getElementById(`${id}Options`).classList.remove('active');
                    onChange(value);
                }
            });

            searchInput.addEventListener('input', (e) => {
                const term = e.target.value.toLowerCase();
                const filtered = list.filter(c => 
                    c.name.toLowerCase().includes(term) || c.value.toLowerCase().includes(term)
                );
                renderOptions(filtered);
            });

            document.getElementById(`${id}Options`).addEventListener('click', (e) => {
                e.stopPropagation();
            });
        }

        function getMinAmount(currency) {
            return minAmounts[currency] || 100;
        }

        function formatMinHint(currency) {
            const min = getMinAmount(currency);
            if (currency === 'SHIB') {
                return `Минимальная сумма: ${Math.floor(min).toLocaleString('ru-RU')} ${currency}`;
            }
            return `Минимальная сумма: ${min.toLocaleString('ru-RU', {
                minimumFractionDigits: currency === 'RUB' ? 2 : 6,
                maximumFractionDigits: currency === 'RUB' ? 2 : 8
            }).replace(/\.?0+$/, '')} ${currency}`;
        }

        function updateUI() {
            const amount = parseFloat(document.getElementById('amount').value) || 0;
            const bankSelectEl = document.getElementById('bankSelect');
            bankSelectEl.style.display = fromValue === 'RUB' ? 'block' : 'none';

            // Обновляем подсказку
            document.getElementById('minHint').textContent = formatMinHint(fromValue);

            if (fromValue === toValue) {
                document.getElementById('rateInfo').textContent = 'Нельзя обменивать одинаковые валюты';
                document.getElementById('result').textContent = '—';
                document.getElementById('nextBtn').disabled = true;
                return;
            }

            const rate = rates[`${fromValue}_${toValue}`] || 0;
            if (rate === 0) {
                document.getElementById('rateInfo').textContent = 'Курс временно недоступен для этой пары';
                document.getElementById('result').textContent = '—';
                document.getElementById('nextBtn').disabled = true;
                return;
            }

            const result = amount * rate;
            const formattedResult = toValue === 'SHIB' 
                ? Math.floor(result).toLocaleString('ru-RU')
                : result.toLocaleString('ru-RU', {
                    minimumFractionDigits: toValue === 'RUB' ? 2 : 6,
                    maximumFractionDigits: toValue === 'RUB' ? 2 : 8
                }).replace(/\.?0+$/, '');

            document.getElementById('rateInfo').innerHTML = 
                `1 ${fromValue} ≈ ${rate.toLocaleString('ru-RU', { maximumFractionDigits: 8 })} ${toValue}`;
            document.getElementById('result').innerHTML = 
                `${amount.toLocaleString('ru-RU')} ${fromValue} ≈ <strong>${formattedResult} ${toValue}</strong>`;

            const minAmount = getMinAmount(fromValue);
            document.getElementById('nextBtn').disabled = amount < minAmount;
        }

        document.getElementById('nextBtn').addEventListener('click', () => {
            const amount = document.getElementById('amount').value;
            const params = new URLSearchParams({ from: fromValue, to: toValue, amount });
            if (fromValue === 'RUB') params.append('bank', bankValue);
            window.location.href = `exchange.html?${params.toString()}`;
        });

        document.getElementById('amount').addEventListener('input', updateUI);

        // Инициализация
        initDropdown('from', allCurrencies, 'RUB', (val) => {
            fromValue = val;
            updateUI();
        });

        initDropdown('to', [...cryptoCurrencies, { value: "RUB", name: "Российский рубль (RUB)" }], 'BTC', (val) => {
            toValue = val;
            updateUI();
        });

        initDropdown('bank', banks, 'sber', (val) => {
            bankValue = val;
        });

        document.addEventListener('click', (e) => {
            if (!e.target.closest('.custom-select')) {
                document.querySelectorAll('.select-options').forEach(el => el.classList.remove('active'));
            }
        });

        updateUI();
    </script>
</body>
</html>